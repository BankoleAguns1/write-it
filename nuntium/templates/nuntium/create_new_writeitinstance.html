{% extends "base_manager.html" %}
{% load i18n %}
{% block sidebar %}
{% endblock sidebar %}
{% block bodyclass %}page-without-sidebar{% endblock bodyclass %}
{% load subdomainurls %}

{% block content %}
<div class="page-header">
    <h2>{% trans "Create your new Site" %}</h2>
</div>

{% blocktrans %}
<p>Youâ€™re going to make a site that enables people to contact their
politicians.</p>
{% endblocktrans %}
<form method="POST">
  <div class="form-group">
    <label>Legislature</label>
    <select class="form-control js-countries-list">
      <option>Select a legislature</option>
      <option disabled></option>
      {% for country in countries %}
      <option data-slug="{{ country.slug }}" value="{{ country.url }}">{{ country.country }} - {{ country.legislature }}</option>
      {% endfor %}
    </select>
  </div>
  <p><a href="#" class="js-show-manual-popolo">I have my own suitably formatted popolo</a></p>
    {% csrf_token %}
    {{form.as_p}}
    <button class='btn btn-primary'>{% trans 'Create' %}</button>
</form>

<script>
  var popitUrl = $('#id_popit_url').closest('p');
  popitUrl.hide();
  var countriesList = $('.js-countries-list');
  $('.js-show-manual-popolo').click(function(e) {
    e.preventDefault();
    popitUrl.show();
    countriesList.closest('div').hide();
    $(this).hide();
  });
  countriesList.change(function(e) {
    $('#id_popit_url').val($(this).val());
    $('#id_slug').val($('option:selected', this).data('slug'));
  });
</script>


{% endblock content %}

{% block extrajs %}
  $('#id_popit_url').keyup(function () {
    var generated_slug = this.value.split('/')[2].split('.')[0];
    $('#id_slug').val(generated_slug.toLowerCase());
  });
{% endblock extrajs %}
